<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Reze</title>
<style>
html,body{height:100%;margin:0;font-family:monospace;overflow:hidden;background:#000;transition:background 1s;}
.bg-video{position:fixed;inset:0;z-index:1;overflow:hidden;pointer-events:none;}
.bg-video video{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:100vw;height:100vh;object-fit:cover;opacity:0;transition:opacity 1s;}
.poster-wrap{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:4;pointer-events:auto;opacity:1;transition:opacity 1s;}
.poster{max-width:80vw;max-height:80vh;cursor:pointer;transition:opacity 1s;user-select:none;}
.poster.fade-out{opacity:0;}
.unmute-btn{position:fixed;top:18px;right:18px;padding:8px 12px;border-radius:8px;background:rgba(0,0,0,.6);color:#fff;border:none;cursor:pointer;display:none;}
#consoleOverlay{position:fixed;top:0;left:0;width:100%;max-height:50%;overflow-y:auto;color:#0f0;font-size:14px;white-space:pre-wrap;padding:2px 5px;z-index:20;pointer-events:none;display:none;}
#cloudPanel{position:fixed;top:20%;left:50%;transform:translateX(-50%);width:380px;padding:15px 20px;background:rgba(0,0,0,0.8);border:1px solid #0f0;border-radius:10px;color:#0f0;z-index:25;display:none;font-family:monospace;box-shadow:0 0 15px #000;}
#cloudPanel h3{margin:0;font-size:16px;text-align:center;border-bottom:1px solid #0f0;padding-bottom:8px;display:flex;justify-content:space-between;align-items:center;}
#cloudPanel .closeBtn{cursor:pointer;font-weight:bold;font-size:16px;}
.file-list{margin-top:10px;max-height:220px;overflow-y:auto;}
.file-item{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(0,255,0,0.2);font-size:13px;}
.file-item a{color:#0f0;text-decoration:none;}
.file-item a:hover{text-decoration:underline;}

/* ---------- Chat Panel ---------- */
#chatPanel{position:fixed;bottom:6%;right:3%;width:340px;height:420px;background:rgba(0,0,0,0.92);border:1px solid #0f0;border-radius:10px;z-index:30;color:#0f0;display:none;box-shadow:0 6px 30px rgba(0,0,0,0.7);font-family:monospace;overflow:hidden;}
#chatHeader{display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid rgba(0,255,0,0.08);}
#chatHeader .title{font-size:14px;}
#chatHeader .controls{display:flex;gap:6px;align-items:center;}
#chatMessages{padding:10px;height:300px;overflow-y:auto;font-size:13px;white-space:pre-wrap;}
.chat-input-wrap{display:flex;padding:8px;border-top:1px solid rgba(0,255,0,0.06);}
.chat-input{flex:1;padding:8px;border-radius:6px;border:1px solid rgba(0,255,0,0.08);background:transparent;color:#0f0;outline:none;font-family:monospace;}
.chat-send{margin-left:8px;padding:8px 10px;border-radius:6px;background:rgba(0,255,0,0.06);border:1px solid rgba(0,255,0,0.2);color:#0f0;cursor:pointer;}
.msg{margin-bottom:8px;}
.msg .meta{font-size:11px;opacity:0.8;margin-bottom:3px;}
.msg .text{font-size:13px;white-space:pre-wrap;}
.msg.me .meta{color:#a0f0a0;}
.msg.they .meta{color:#7fe0ff;}
#chatFooter{font-size:11px;padding:6px 10px;border-top:1px solid rgba(0,255,0,0.04);opacity:0.9;}
.small-btn{background:transparent;border:1px solid rgba(0,255,0,0.06);padding:4px 6px;border-radius:6px;color:#0f0;cursor:pointer;}

/* ---------- Nickname Modal ---------- */
#nickModal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.95);border:1px solid #0f0;border-radius:10px;padding:20px;z-index:50;display:none;width:280px;box-shadow:0 0 20px #000;color:#0f0;font-family:monospace;}
#nickModal input{width:100%;padding:8px;border-radius:6px;border:1px solid rgba(0,255,0,0.2);background:transparent;color:#0f0;outline:none;margin-bottom:10px;}
#nickModal .modal-buttons{display:flex;justify-content:flex-end;gap:8px;}
#nickModal .modal-buttons button{padding:6px 10px;border-radius:6px;border:1px solid rgba(0,255,0,0.2);background:rgba(0,255,0,0.06);color:#0f0;cursor:pointer;}
</style>
</head>
<body>

<div class="poster-wrap">
    <img id="poster" class="poster" src="https://github.com/2uji/2uji.github.io/blob/main/Reze.jpg?raw=true" alt="Click to Play">
</div>

<div class="bg-video">
    <video id="bgVideo" playsinline preload="metadata" muted loop>
        <source src="https://github.com/2uji/2uji.github.io/raw/refs/heads/main/Reze.mp4" type="video/mp4">
    </video>
</div>

<button id="unmute" class="unmute-btn">Unmute</button>
<div id="consoleOverlay"></div>

<div id="cloudPanel">
  <h3>Cloud Access Panel <span class="closeBtn" id="closeCloud">✖</span></h3>
  <div class="file-list"></div>
</div>

<!-- Chat Panel -->
<div id="chatPanel" aria-hidden="true">
  <div id="chatHeader">
    <div class="title">Chat</div>
    <div class="controls">
      <button id="nickBtn" class="small-btn" title="Change Nickname">Nick</button>
      <button id="clearChatBtn" class="small-btn" title="Clear Chat">Clear</button>
      <button id="closeChatBtn" class="small-btn" title="Close Chat">Close</button>
    </div>
  </div>
  <div id="chatMessages" role="log" aria-live="polite"></div>
  <div class="chat-input-wrap">
    <input id="chatInput" class="chat-input" placeholder="Type a message (Enter = Send)" />
    <button id="chatSend" class="chat-send">Send</button>
  </div>
  <div id="chatFooter">Chat is real-time with Firebase.</div>
</div>

<!-- Nickname Modal -->
<div id="nickModal">
  <div>Enter new nickname:</div>
  <input id="nickInput" placeholder="Nickname" />
  <div class="modal-buttons">
    <button id="nickSave">Save</button>
    <button id="nickCancel">Cancel</button>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ---------- Firebase Init ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyCGqLdJPckct5b2tmnMw07dxzwKvravKKI",
  authDomain: "reze-f1dcf.firebaseapp.com",
  databaseURL: "https://reze-f1dcf-default-rtdb.firebaseio.com",
  projectId: "reze-f1dcf",
  storageBucket: "reze-f1dcf.firebasestorage.app",
  messagingSenderId: "682614546253",
  appId: "1:682614546253:web:64733cbe77ac13cae9a104"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const messagesRef = db.ref('reze_chat');

/* ---------- Main Elements ---------- */
const poster=document.getElementById('poster'),
      posterWrap=document.querySelector('.poster-wrap'),
      video=document.getElementById('bgVideo'),
      unmuteBtn=document.getElementById('unmute'),
      consoleOverlay=document.getElementById('consoleOverlay'),
      cloudPanel=document.getElementById('cloudPanel'),
      closeCloud=document.getElementById('closeCloud');

/* ---------- Chat Elements ---------- */
const chatPanel=document.getElementById('chatPanel'),
      chatMessages=document.getElementById('chatMessages'),
      chatInput=document.getElementById('chatInput'),
      chatSend=document.getElementById('chatSend'),
      closeChatBtn=document.getElementById('closeChatBtn'),
      clearChatBtn=document.getElementById('clearChatBtn'),
      nickBtn=document.getElementById('nickBtn');

/* ---------- Nick Modal Elements ---------- */
const nickModal=document.getElementById('nickModal'),
      nickInput=document.getElementById('nickInput'),
      nickSave=document.getElementById('nickSave'),
      nickCancel=document.getElementById('nickCancel');

let consoleStarted=false;
let myNick=localStorage.getItem('reze_chat_nick')||('User-'+Math.floor(Math.random()*9000+1000));

/* ---------- Poster Click / Video ---------- */
poster.onclick=async()=>{
  poster.classList.add('fade-out');
  posterWrap.style.pointerEvents='none';
  setTimeout(async()=>{
    posterWrap.style.opacity='0';
    video.style.opacity='1'; video.style.display='block'; video.currentTime=0; video.muted=false;
    try{await video.play();}catch{video.controls=true;}
    unmuteBtn.style.display='none'; document.body.style.cursor='none';
    startConsole();
  },500);
};
unmuteBtn.onclick=async()=>{try{video.muted=false;if(video.paused)await video.play();unmuteBtn.style.display='none';}catch{}};

/* ---------- Console ---------- */
function startConsole(){
  if(consoleStarted) return; consoleStarted=true;
  consoleOverlay.style.display='block'; document.body.style.cursor='auto';
  let text='',input='',idx=0;
  const prompt='>',
        bootLines=['[SYS] Boot sequence initiated...','[OK] Loading environment variables...','[OK] Establishing neural link...','[INFO] Ready for input.'];

  const render=()=>{consoleOverlay.innerHTML=text+prompt+input+'<span class="cursor">█</span>'; consoleOverlay.scrollTop=consoleOverlay.scrollHeight;};
  const append=line=>{ if(line!==undefined && line!==null && line!==false) text+=line+'\n'; render(); };

  async function loadCloud(){
    append('[ACCESS] Connecting to cloud repository...');
    try{
      const res=await fetch('https://api.github.com/repos/2uji/cloud/contents/');
      const data=await res.json();
      const fileList=cloudPanel.querySelector('.file-list');
      fileList.innerHTML='';
      data.forEach(f=>{
        if(f.type==='file'){
          const div=document.createElement('div');
          div.className='file-item';
          div.innerHTML=`<span>${f.name}</span><a href="${f.download_url}" download>Download</a>`;
          fileList.appendChild(div);
        }
      });
      append('[OK] Cloud data synced successfully.');
    }catch{append('[ERROR] Failed to connect to cloud.');}
  }

  /* ---------- Chat Logic (Firebase Realtime) ---------- */
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g,(c)=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

  function renderChat(msg){
    const div=document.createElement('div');
    const cls=(msg.nick===myNick)?'msg me':'msg they';
    const time=new Date(msg.t).toLocaleTimeString();
    div.className=cls;
    div.innerHTML=`<div class="meta">${escapeHtml(msg.nick)} · ${time}</div><div class="text">${escapeHtml(msg.text)}</div>`;
    chatMessages.appendChild(div);
    chatMessages.scrollTop=chatMessages.scrollHeight;
  }

  function sendMessage(text){
    if(!text||!text.trim())return;
    messagesRef.push({nick:myNick,text:text.trim(),t:Date.now()});
  }

  chatSend.addEventListener('click',()=>{ sendMessage(chatInput.value); chatInput.value=''; chatInput.focus(); });
  chatInput.addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); sendMessage(chatInput.value); chatInput.value=''; } });

  function openChat(){
    chatPanel.style.display='block';
    chatPanel.setAttribute('aria-hidden','false');
    chatInput.focus();
  }

  function closeChat(){ chatPanel.style.display='none'; chatPanel.setAttribute('aria-hidden','true'); }
  closeChatBtn.addEventListener('click',()=>{ closeChat(); });

  clearChatBtn.addEventListener('click',()=>{
    if(!confirm('Clear chat history?')) return;
    messagesRef.remove();
    chatMessages.innerHTML='';
  });

  /* ---------- Nick Modal Logic ---------- */
  nickBtn.addEventListener('click',()=>{
    nickInput.value=myNick;
    nickModal.style.display='block';
    nickInput.focus();
  });

  nickSave.addEventListener('click',()=>{
    const newNick=nickInput.value.trim();
    if(newNick){ myNick=newNick; localStorage.setItem('reze_chat_nick', myNick); }
    nickModal.style.display='none';
  });

  nickCancel.addEventListener('click',()=>{ nickModal.style.display='none'; });

  // Close modal on Enter
  nickInput.addEventListener('keydown',e=>{
    if(e.key==='Enter'){ e.preventDefault(); nickSave.click(); }
    if(e.key==='Escape'){ e.preventDefault(); nickCancel.click(); }
  });

  // Listen for new messages in real-time
  messagesRef.on('child_added', snapshot => { renderChat(snapshot.val()); });

  /* ---------- Keyboard Commands ---------- */
  document.addEventListener('keydown',e=>{
    if(consoleOverlay.style.display!=='block')return;
    const activeEl=document.activeElement;
    if(activeEl && (activeEl.tagName==='INPUT'||activeEl.id==='chatInput'))return;

    if(e.key==='Backspace') input=input.slice(0,-1);
    else if(e.key.length===1) input+=e.key;
    else if(e.key==='Enter'){
      append(prompt+input);
      const cmd=input.toLowerCase().trim();
      if(cmd==='mute'){video.muted=!video.muted; append(`[INFO] Video is now ${video.muted?'muted':'unmuted'}.`);}
      else if(cmd==='cloud'){cloudPanel.style.display='block'; append('[ACCESS] Cloud panel opened.'); loadCloud();}
      else if(cmd==='chat'){openChat(); append('[CHAT] Chat panel opened.');}
      else if(cmd==='clear'){text=''; render();}
      else if(cmd==='help'){append('[HELP] Commands: mute, cloud, chat, clear, help, sysinfo');}
      else if(cmd==='sysinfo'){
        append('[SYSINFO]');
        append('  User Agent: '+navigator.userAgent);
        append('  Screen: '+screen.width+'x'+screen.height);
        append('  Language: '+navigator.language);
        append('  Platform: '+(navigator.platform||'unknown'));
      }
      else if(cmd.length>0) append('[ERROR] Unknown command: '+cmd);
      input='';
    }
    render();
  });

  /* ---------- Boot Sequence ---------- */
  const boot=setInterval(()=>{ append(bootLines[idx]); if(++idx>=bootLines.length){ clearInterval(boot); append(); }},800);
  closeCloud.onclick=()=>{ cloudPanel.style.display='none'; };
  render();
}
</script>
</body>
</html>
