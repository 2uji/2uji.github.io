<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>404 Not Found</title>
<style>
  body {
    margin: 0;
    background-color: #fff;
    color: #000;
    font-family: monospace;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    flex-direction: column;
    overflow: hidden;
    user-select: none;
    position: relative;
    transition: background-color 1s;
  }

  #container {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    width: 100%;
    padding: 20px;
    transition: opacity 1s;
  }

  h1 { 
    font-size: 5em; 
    margin: 0.2em 0; 
    cursor: pointer;
  }
  p { margin: 0.2em 0; }
  #errorCode { font-size: 0.9em; color: #999; }

  #passwordToggle {
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.8);
    padding: 20px;
    border-radius: 12px;
    color: #fff;
    z-index: 2000;
    transition: opacity 1s;
  }
  #passwordToggle input {
    padding: 6px 10px;
    border-radius: 6px;
    border: none;
    outline: none;
    font-size: 16px;
  }
  #passwordToggle button {
    padding: 6px 12px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-weight: bold;
    background-color: #fff;
    color: #000;
  }
  #errorMsg { color: #f55; font-size: 14px; display: none; }

  #flashLayer {
    position: fixed;
    inset: 0;
    background-color: red;
    pointer-events: none;
    opacity: 0;
    z-index: 3000;
    transition: opacity 0.1s;
  }

  #irisOutScreen {
    display: none;
    position: fixed;
    inset: 0;
    background-color: #fff;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    flex-direction: column;
    transition: opacity 1s;
  }
  #irisOutScreen img {
    max-width: 80vw;
    max-height: 80vh;
  }

  #contentFrame {
    display: none;
    width: 100%;
    height: 100vh;
    border: none;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 2000;
  }

  #ghostInput{
    position: fixed;
    left: 0; bottom: 0;
    width: 1px; height: 1px;
    opacity: 0;
    border: 0; outline: none;
    font-size: 16px;
    z-index: 1;
    background: transparent;
    color: transparent;
    caret-color: transparent;
  }
</style>
</head>
<body>
  <div id="container">
    <h1 id="zero">404</h1>
    <p>Page Not Found</p>
    <p id="errorCode">Error_Code Bomb!</p>
  </div>

  <div id="passwordToggle">
    <input type="password" id="passwordInput" placeholder="Enter password" />
    <button id="submitPassword">Enter</button>
    <div id="errorMsg">Fail</div>
  </div>

  <div id="flashLayer"></div>

  <div id="irisOutScreen">
    <img id="irisOutCover" src="https://github.com/2uji/2uji.github.io/blob/reze/assets/irisoutcover.jpg?raw=true" alt="Iris Out Cover">
  </div>

  <iframe id="contentFrame"></iframe>

  <input id="ghostInput" inputmode="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />

<script>
const zero = document.getElementById('zero');
const passwordToggle = document.getElementById('passwordToggle');
const passwordInput = document.getElementById('passwordInput');
const submitPassword = document.getElementById('submitPassword');
const errorMsg = document.getElementById('errorMsg');
const container = document.getElementById('container');
const flashLayer = document.getElementById('flashLayer');
const irisOutScreen = document.getElementById('irisOutScreen');
const contentFrame = document.getElementById('contentFrame');
const ghostInput = document.getElementById('ghostInput');

let audioBomb, audioIrisOut;

let irisMode = false;

async function sha256(str) {
  const buf = new TextEncoder().encode(str);
  const hashBuf = await crypto.subtle.digest('SHA-256', buf);
  return Array.from(new Uint8Array(hashBuf))
    .map(b => b.toString(16).padStart(2, '0'))
    .join('');
}

const correctHash = 'e65f0dea598d37fd645ffca389c0846c431cfed03b919388e03c70a6ce8627a2';

zero.addEventListener('click', () => {
  passwordToggle.style.display = passwordToggle.style.display === 'flex' ? 'none' : 'flex';
  passwordInput.value = '';
  errorMsg.style.display = 'none';
  passwordInput.focus();
});

function triggerFlashEffect() {
  let flashes = 0;
  const maxFlashes = 6;
  const interval = setInterval(() => {
    flashLayer.style.opacity = flashLayer.style.opacity === '0' ? '0.6' : '0';
    flashes++;
    if (flashes >= maxFlashes) {
      flashLayer.style.opacity = '0';
      clearInterval(interval);
    }
  }, 80);
}

function focusGhost() {
  try {
    ghostInput.focus();
    setTimeout(() => {
      try { ghostInput.setSelectionRange(ghostInput.value.length, ghostInput.value.length); } catch {}
    }, 0);
  } catch {}
}

function handleRezeTransition() {
  if (audioIrisOut && !audioIrisOut.paused) {
    audioIrisOut.pause();
    audioIrisOut.currentTime = 0;
  }
  document.body.style.transition = 'background-color 1s';
  document.body.style.backgroundColor = '#000';
  container.style.transition = 'opacity 1s';
  container.style.opacity = 0;
  passwordToggle.style.transition = 'opacity 1s';
  passwordToggle.style.opacity = 0;
  irisOutScreen.style.transition = 'opacity 1s';
  irisOutScreen.style.opacity = 0;

  setTimeout(() => {
    container.style.display = 'none';
    passwordToggle.style.display = 'none';
    irisOutScreen.style.display = 'none';
    contentFrame.src = 'Reze.html';
    contentFrame.style.display = 'block';
  }, 1000);
}

function openIrisOut() {
  irisMode = true;
  focusGhost();

  audioBomb = new Audio('https://github.com/2uji/2uji.github.io/raw/refs/heads/reze/assets/Bomb!.mp3');
  audioBomb.volume = 1.0;
  audioBomb.addEventListener('play', triggerFlashEffect);
  audioBomb.play().catch(()=>{});

  setTimeout(() => {
    audioIrisOut = new Audio('https://github.com/2uji/2uji.github.io/raw/refs/heads/reze/assets/IRIS%20OUT.mp3');
    audioIrisOut.volume = 1.0;
    audioIrisOut.play().catch(()=>{});
  }, 1000);

  container.style.transition = 'opacity 1s';
  container.style.opacity = 0;
  passwordToggle.style.transition = 'opacity 1s';
  passwordToggle.style.opacity = 0;
  setTimeout(() => {
    container.style.display = 'none';
    passwordToggle.style.display = 'none';
    irisOutScreen.style.display = 'flex';
    irisOutScreen.style.opacity = 1;
    focusGhost();
  }, 1000);
}

submitPassword.addEventListener('click', async () => {
  errorMsg.style.display = 'none';
  try {
    const val = passwordInput.value.trim();
    const hash = await sha256(val);
    if (hash === correctHash) {
      openIrisOut();
    } else {
      errorMsg.style.display = 'block';
      passwordInput.value = '';
      passwordInput.focus();
    }
  } catch (err) {
    console.error(err);
    errorMsg.textContent = 'Error';
    errorMsg.style.display = 'block';
  }
});

passwordInput.addEventListener('keyup', (e) => {
  if (e.key === 'Enter') submitPassword.click();
});

let bombBuffer = '';
let rezeBuffer = '';

function pushChars(s){
  const latin = (s || '').toLowerCase().replace(/[^a-z]/g,'');
  if (!latin) return;
  rezeBuffer += latin;
  if (rezeBuffer.length > 32) rezeBuffer = rezeBuffer.slice(-32);
  if (irisMode && rezeBuffer.includes('reze')) {
    handleRezeTransition();
    rezeBuffer = '';
    irisMode = false;
  }
}

document.addEventListener('keydown', (e) => {
  const k = e.key && e.key.length === 1 ? e.key : '';
  if (k) pushChars(k);

  bombBuffer += (e.key || '').toLowerCase();
  if (bombBuffer.includes('bomb!')) {
    openIrisOut();
    bombBuffer = '';
  }
  if (bombBuffer.length > 10) bombBuffer = bombBuffer.slice(-10);
});

ghostInput.addEventListener('compositionend', (e)=>{
  pushChars(e.data);
  ghostInput.value = '';
});

ghostInput.addEventListener('beforeinput', (e)=>{
  if (e.data) pushChars(e.data);
});

ghostInput.addEventListener('input', ()=>{
  if (ghostInput.value) pushChars(ghostInput.value);
  ghostInput.value = '';
});

['pointerdown','click','touchend'].forEach(ev=>{
  document.addEventListener(ev, ()=>{
    if (irisMode) focusGhost();
  }, { passive: true });
});

document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'visible' && irisMode) focusGhost();
});
</script>
</body>
</html>
